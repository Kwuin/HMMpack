# Hidden Markov Model for sequential data
This is a R package for implementing Hidden Markov Models(HMM) for sequential data. It includes functionalities of generating synthetic data with arbitray transition matrices, initial distribution and differnet emission distribution for continuous data. It can also be used to do Bayesian inference using Rstan to do Hamiltonian Monte Carlo sampling method. Calculation of log likelihood for given sequential data and model is provided. 

## Installation
Run the following code in Rstudio: 
```{r}
devtools::install_github("Kwuin/HMMpack")
```
## small example 
```{r}
library(HMMpack)
# Generate sample data
# Simulate data
N <- 200  # shorter sequence for testing
K <- 3    # number of states

# True parameters (more separated means for better identification)
pi_true <- c(0.6, 0.3, 0.1)
A_true <- matrix(c(0.8, 0.1, 0.1,
                   0.1, 0.8, 0.1,
                   0.1, 0.1, 0.8),
                 nrow = K, byrow = TRUE)
mu_true <- c(-3, 0, 3)
sigma_true <- c(0.5, 0.5, 0.5)

hmm_model = HMM(K,A_true, pi_true, seed = seed)
hmm_gaussian_model = HMM_Gaussian_Model(hmm_model, sigma_true^2)
```
# Fit model
```{r}
y <- hmm_gaussian_model$generate_gaussian_observations(N)$observations
y
```
N = 100 samples generated from this Hidden Markov Model with gaussian as emission distribution 
is 
```{r}
  [1]  0.64479672  1.12844185  0.87665406  2.82622870  0.52419072  0.97748614  0.60754777
  [8]  2.16602903  2.80988674  3.45949830  0.71232652  1.30398216  0.19105865  0.97221902
 [15]  1.25970360  3.15057668  3.05283810  2.67964700  2.57514783  0.48793560  3.05882330
 [22]  2.52626269  2.75472128  0.87195390  1.92193100  0.67402505  1.11769329  1.03898042
 [29]  0.51907168  0.96434596  2.72227543  1.22575203  1.02061646  0.78875158 -0.02662361
 [36]  1.56566861  0.26967996  1.36997376  1.95455178  0.27805342  1.35089217  0.86890126
 [43]  0.21392792  0.24266617  0.19923191  0.73454674  0.26912221  1.34395839  2.05005447
 [50]  2.35648476  3.39386942  3.38452112  3.16610129  2.49581170  2.94027370  2.85980233
 [57]  3.28149477  2.81378062  2.48848669  1.81270957  2.52635573  1.47541150  1.36992238
 [64]  3.62051997  2.79157121  3.14911380  2.31828484  2.75810969  3.25843102  3.18448226
 [71]  2.89230975  3.03264652  2.98296637  4.06422595  2.62933195  2.45200187  3.01889420
 [78]  3.15524037  3.21826174  2.77081733  2.46833693  3.63159259  2.82517481  2.56724357
 [85]  2.88186022  2.90141205  1.55496014  3.04236865  2.37702689  1.75035399  2.10722265
 [92]  1.83765704  2.04729176  1.55231832  1.34459923  2.99860669  2.30035441  1.37436432
 [99]  1.69441704  1.40725996  3.09940517  2.65620649  1.86742747  1.27159703  0.79283003
[106]  2.76187655  0.60569858  0.70269137  1.82545373  0.97298594  2.05962262  2.12184371
[113]  2.61623794  0.74196808  0.50374642  1.83784847  0.77941839  1.63846702  1.38186344
[120]  1.35764214  1.71301326  2.30899291  2.55492407  2.35379418  1.81817135  1.02987497
[127]  0.64770177  0.64139092  1.44232525  0.49220371  1.97764698  2.95484020  3.10726941
[134]  2.63073615  2.71280566  2.34149193  1.90853731  2.20949120  1.16215217  0.60923176
[141]  0.60568901  0.74890064  1.74803033  0.43134819  2.91047420  3.95118091  2.94951256
[148]  2.32007965  2.66761528  3.24272999  1.81219856  1.71906182  1.82804138  2.04524832
[155]  2.79925439  1.95571744  2.54039975  2.31537706  1.94318005  1.23354900  1.73944134
[162]  1.75506477  2.02357722  2.65009934  3.14653949  2.77379053  1.93342452  1.12173630
[169]  1.80561007  2.04460361  2.42250650  2.48126398  3.34215471  2.30236283  3.42482152
[176]  2.77672139  3.08740135  3.03727559  2.21408338  2.01233749  2.16626245  3.36824798
[183]  3.19301328  2.86717419  3.05907226  3.06701932  3.11050973  3.82042308  0.89047481
[190]  2.08403269  2.58419194  2.52709051  1.57263156  0.71126600  3.00124137  2.03335044
[197]  2.93342592  1.32454866  2.01049179  2.62495729
```

Continue to fit the model with Rstan.
```{r}
stan_data <- list(
  N = N,
  K = K,
  y = y
)

fit = stan_fit("hmm.stan", stan_data)
```
# Result

```{r}
   Mean          SE         SD       2.5%        25%        50%       75%     97.5%
A[1,1]   0.66115466 0.003309240 0.10002656 0.42898307 0.61206489 0.67353891 0.7293425 0.8188173
A[2,1]   0.18925955 0.002547082 0.08723544 0.05482830 0.12861037 0.17682799 0.2357428 0.3969712
A[3,1]   0.09455973 0.000976355 0.04590839 0.02060377 0.06045449 0.08857832 0.1225740 0.1970917
A[1,2]   0.20625098 0.002925539 0.10160466 0.05298977 0.13491851 0.19206650 0.2627189 0.4448407
A[2,2]   0.61198511 0.004154497 0.13235567 0.29762218 0.53519804 0.62861117 0.7054518 0.8197277
A[3,2]   0.16376710 0.001547637 0.06602911 0.06209495 0.11761740 0.15560644 0.2001188 0.3079083
A[1,3]   0.13259436 0.001213580 0.06111066 0.03244008 0.08866861 0.12732868 0.1708514 0.2632525
A[2,3]   0.19875534 0.002223082 0.09312143 0.05817264 0.13065011 0.18483968 0.2520631 0.4189657
A[3,3]   0.74167317 0.001575828 0.06928542 0.59723770 0.70348714 0.74700415 0.7880609 0.8549394
mu[1]    0.90085377 0.003465718 0.12872735 0.65840458 0.81435285 0.89493782 0.9806819 1.1735704
mu[2]    1.99103490 0.007121626 0.18232897 1.61042626 1.89062890 1.99637891 2.1014928 2.3286894
mu[3]    2.90684871 0.002048327 0.08141199 2.72875266 2.85923143 2.91219926 2.9618928 3.0490904
sigma[1] 0.48501067 0.002132800 0.08838861 0.32554137 0.42641070 0.47910489 0.5346591 0.6812802
sigma[2] 0.51539568 0.003027099 0.10568578 0.30025066 0.44896653 0.51475605 0.5823705 0.7213633
sigma[3] 0.42111084 0.001284965 0.05096430 0.33299078 0.38555359 0.41690392 0.4527283 0.5284288
             N_eff     Rhat
A[1,1]    913.6377 1.002816
A[2,1]   1173.0053 1.001337
A[3,1]   2210.8972 1.001497
A[1,2]   1206.1889 1.001520
A[2,2]   1014.9583 1.001654
A[3,2]   1820.2575 1.001169
A[1,3]   2535.6969 1.000942
A[2,3]   1754.6406 1.000962
A[3,3]   1933.1517 1.001979
mu[1]    1379.6063 1.002749
mu[2]     655.4702 1.002287
mu[3]    1579.7133 1.001656
sigma[1] 1717.4827 1.001199
sigma[2] 1218.9333 1.002001
sigma[3] 1573.0766 1.000318
```
From the result we can see that for parameters of transition matrix A, its parameters are properly estimated. 
Given the small number of data, the discrepancy from the true parameters is still non-neglegible. 
For the starting distribution $\mu$, it doesn't estimate well because we are infering on one single chain and there is not
enough sample data to properly estimate $\mu$. The standard deviation of the emission distributions are estimated correctly. 


